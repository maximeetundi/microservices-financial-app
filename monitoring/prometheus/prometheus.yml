# Prometheus Configuration for Zekora Microservices
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'zekora-production'
    env: 'production'

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

# Load rules
rule_files:
  - /etc/prometheus/alerts/*.yml

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    metrics_path: /metrics

  # Node Exporter - Host metrics
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'host'

  # cAdvisor - Container metrics
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']
    relabel_configs:
      - source_labels: [container_label_com_docker_compose_service]
        target_label: service

  # PostgreSQL Exporter
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres-exporter:9187']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'postgres'

  # Redis Exporter
  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'redis'

  # RabbitMQ Exporter
  - job_name: 'rabbitmq'
    static_configs:
      - targets: ['rabbitmq-exporter:9419']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'rabbitmq'

  # Kong API Gateway (if metrics enabled)
  - job_name: 'kong'
    static_configs:
      - targets: ['api-gateway:8001']
    metrics_path: /metrics

  # Microservices (Go services with /metrics endpoint)
  - job_name: 'auth-service'
    static_configs:
      - targets: ['auth-service:8081']
    metrics_path: /metrics

  - job_name: 'wallet-service'
    static_configs:
      - targets: ['wallet-service:8083']
    metrics_path: /metrics

  - job_name: 'transfer-service'
    static_configs:
      - targets: ['transfer-service:8084']
    metrics_path: /metrics

  - job_name: 'exchange-service'
    static_configs:
      - targets: ['exchange-service:8085']
    metrics_path: /metrics

  - job_name: 'card-service'
    static_configs:
      - targets: ['card-service:8086']
    metrics_path: /metrics

  - job_name: 'notification-service'
    static_configs:
      - targets: ['notification-service:8087']
    metrics_path: /metrics

  - job_name: 'admin-service'
    static_configs:
      - targets: ['admin-service:8088']
    metrics_path: /metrics

  - job_name: 'support-service'
    static_configs:
      - targets: ['support-service:8089']
    metrics_path: /metrics

  - job_name: 'ticket-service'
    static_configs:
      - targets: ['ticket-service:8090']
    metrics_path: /metrics

  # Grafana self-monitoring
  - job_name: 'grafana'
    static_configs:
      - targets: ['grafana:3000']
    metrics_path: /metrics
